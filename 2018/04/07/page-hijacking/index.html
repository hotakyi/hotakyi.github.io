<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="hota's blog" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>網頁劫持 - hota's blog</title><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">hota's blog</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li><li class="head-nav__item"><a href="/about" class="head-nav__link">About</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2018-04-06T16:00:00.000Z" class="post__time">April 7, 2018</time><h1 class="post__title"><a href="/2018/04/07/page-hijacking/">網頁劫持</a></h1></header><div class="post__main echo"><p><img src="/images/turkey-google-dns.jpg" alt=""></p>
<p>看到最近好像大陸的網頁劫持越來越嚴重，所以想說一下。</p>
<p>從你打開瀏覽器，到網頁加載完成，中間經過很多個環節。在當中很多個環節都可能會有被注入的機會。這裡先假設瀏覽器、服務器都是安全的。</p>
<h3 id="DNS-劫持"><a href="#DNS-劫持" class="headerlink" title="DNS 劫持"></a>DNS 劫持</h3><p>網絡中的地址都是 IP，當你瀏覽器輸入網址，瀏覽器會把當中的域名發到 DNS 服務器，從而拿到 IP 地址；瀏覽器再訪問這個 IP 地址獲取網頁。由於 DNS 服務器可能被污染，或是有意為之；或者你的電腦或手機的 HOSTS 文件被某軟件修改；或者在網上看到教學說換了個 DNS IP 可以提高速度的那種，都可以讓你輸入網址之後連不到真實的服務器。有可能會到了一些廣告頁面，達到引導流量的目的。網絡供應商的 DNS，你連上的網絡、Wifi 時自動拿到的 DNS 都可以進行這個操作，這也是為什麼使用公共 Wifi 危險的原因。</p>
<p>順帶一提，有些人說沒密碼的 Wifi 不安全，那是因為通訊可以被附近的人監測到；但就算 Wifi 是加密的，提供 Wifi 的人也是可以做手腳的，所以在使用別人的 Wifi 時使用 VPN 比較安全，這也是很多 VPN 供應商推銷服務的口號之一。同時使用 VPN 就跳過了 Wifi 自動提供的 DNS。但是上面說的事情 VPN 供應商一樣可以做到，所以自己租服務器架設 VPN 服務才比較有保障。</p>
<h3 id="HTTP-注入"><a href="#HTTP-注入" class="headerlink" title="HTTP 注入"></a>HTTP 注入</h3><p>另一種常見的劫持是 HTTP 注入，基本上大陸的網絡供應商、手機網絡都在搞這個。就是通常在頁面左右下角出現的按扭，點解拿話費拿流量的那種；說是 HTTP 其實還可以替換了你整個頁面；除了在頁面的 HTML 注入外，還可以在網頁裡的 Javascript 下手。Javascript 被注入後，注入者就可以在頁面上執行他們的代碼，例如彈窗、滿屏廣告之類。</p>
<h2 id="防範手段"><a href="#防範手段" class="headerlink" title="防範手段"></a>防範手段</h2><p>作為瀏覽網頁的人，看你對自己的網上安全有多重視，注意上面說的幾點。特別是需要輸入密碼的網頁，一定要注意網站是不是使用 HTTPS。因為 HTTPS 需要證書，證書要由<strong>你的瀏覽器認可的機構簽發</strong>才能通過瀏覽器的檢查，通常網址欄左邊會有綠色的鎖代表通過檢查；所以為什麼要拒絕流氓瀏覽器，無論它能提供多大的便利。HTTPS 因為連線是加密的，中間人不能注入或監聽通訊；第二是要有公認的機構認證，可以確保真的是你想要看的網頁。</p>
<p>作為網站的開發或者，使用 HTTPS 是最基本的了。以前有一段時間使多網站都同時提供 HTTP 跟 HTTPS 版本。主要可能是 HTTPS 會帶來 overhead，影響打開網站的反應速度。但是到了現在這一點點的差別已經可以完全無視了。把 HTTP 的訪問使用 301 Redirect 到 HTTPS，除了可以防止 HTTP 注入，瀏覽器會永久緩存 301 Redirect。瀏覽過你的網站的人，下次無論打開 HTTP 或 HTTPS 網站都會到 HTTPS 那裡。而 HTTPS 需要證書，所以也防止了 DNS 劫持，瀏覽器會彈出危險警告。</p>
<p>現在很多 HTTPS 用的 SSL 證書基本的才 US$10 一張，還有 <a href="https://letsencrypt.org" target="_blank" rel="noopener">Let’s Encrypt</a> 提供免費的證書，除了自甘墜落之外已經沒有不用的理由。雖然他們的免費證書只有 90 天，但是他們提供工具給你安全在服務器來自動化整個申請流程。當然肯定有人已經做好了 docker image，安裝了 docker 的同學可以一個命令生成證書，可以到<a href="https://github.com/pierreprinetti/certbot" target="_blank" rel="noopener">這裡</a>看看。還沒投身<a href="https://www.docker.com/" target="_blank" rel="noopener">Docker</a>的同學要快點上車了。</p>
</div><footer class="post__foot u-cf"><a href="/2018/04/07/page-hijacking/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2018 Joe Leung</div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><a title="Next" href="/2018/04/06/encrypted-chat/" class="page-menu__link icon-arrow-right"></a></li></menu></footer></body></html>