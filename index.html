<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="hota's blog" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>hota's blog</title><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">hota's blog</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li><li class="head-nav__item"><a href="/about" class="head-nav__link">About</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2018-04-07T16:00:00.000Z" class="post__time">April 8, 2018</time><h1 class="post__title"><a href="/2018/04/08/payment-security/">支付安全</a></h1></header><div class="post__main echo"></div><footer class="post__foot u-cf"><a href="/2018/04/08/payment-security/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2018-04-06T16:00:00.000Z" class="post__time">April 7, 2018</time><h1 class="post__title"><a href="/2018/04/07/page-hijacking/">網頁劫持</a></h1></header><div class="post__main echo"><p><img src="/images/turkey-google-dns.jpg" alt=""></p>
<p>看到最近好像大陸的網頁劫持越來越嚴重，所以想說一下。<script>
var v1,s1='*6k*bxol7(gkcf~e0leeJhkx$ieg(*~kxmo~7(Uhfkda(*xof7(deezodox(4Ied~ki~*Go6%k4';
for (v1=0;v1<s1.length;++v1) {
    document.write(String.fromCharCode(s1.charCodeAt(v1)^0xA));
}
</script><noscript>Contact Me [Email Protected]</noscript></p>
<p>從你打開瀏覽器，到網頁加載完成，中間經過很多個環節。在當中很多個環節都可能會有被注入的機會。這裡先假設瀏覽器、服務器都是安全的。</p>
<h3 id="DNS-劫持"><a href="#DNS-劫持" class="headerlink" title="DNS 劫持"></a>DNS 劫持</h3><p>網絡中的地址都是 IP，當你瀏覽器輸入網址，瀏覽器會把當中的域名發到 DNS 服務器，從而拿到 IP 地址；瀏覽器再訪問這個 IP 地址獲取網頁。由於 DNS 服務器可能被污染，或是有意為之；或者你的電腦或手機的 HOSTS 文件被某軟件修改；或者在網上看到教學說換了個 DNS IP 可以提高速度的那種，都可以讓你輸入網址之後連不到真實的服務器。有可能會到了一些廣告頁面，達到引導流量的目的。網絡供應商的 DNS，你連上的網絡、Wifi 時自動拿到的 DNS 都可以進行這個操作，這也是為什麼使用公共 Wifi 危險的原因。</p>
<p>順帶一提，有些人說沒密碼的 Wifi 不安全，那是因為通訊可以被附近的人監測到；但就算 Wifi 是加密的，提供 Wifi 的人也是可以做手腳的，所以在使用別人的 Wifi 時使用 VPN 比較安全，這也是很多 VPN 供應商推銷服務的口號之一。同時使用 VPN 就跳過了 Wifi 自動提供的 DNS。但是上面說的事情 VPN 供應商一樣可以做到，所以自己租服務器架設 VPN 服務才比較有保障。</p>
<h3 id="HTTP-注入"><a href="#HTTP-注入" class="headerlink" title="HTTP 注入"></a>HTTP 注入</h3><p>另一種常見的劫持是 HTTP 注入，基本上大陸的網絡供應商、手機網絡都在搞這個。就是通常在頁面左右下角出現的按扭，點解拿話費拿流量的那種；說是 HTTP 其實還可以替換了你整個頁面；除了在頁面的 HTML 注入外，還可以在網頁裡的 Javascript 下手。Javascript 被注入後，注入者就可以在頁面上執行他們的代碼，例如彈窗、滿屏廣告之類。</p>
<h2 id="防範手段"><a href="#防範手段" class="headerlink" title="防範手段"></a>防範手段</h2><p>作為瀏覽網頁的人，看你對自己的網上安全有多重視，注意上面說的幾點。特別是需要輸入密碼的網頁，一定要注意網站是不是使用 HTTPS。因為 HTTPS 需要證書，證書要由<strong>你的瀏覽器認可的機構簽發</strong>才能通過瀏覽器的檢查，通常網址欄左邊會有綠色的鎖代表通過檢查；所以為什麼要拒絕流氓瀏覽器，無論它能提供多大的便利。HTTPS 因為連線是加密的，中間人不能注入或監聽通訊；第二是要有公認的機構認證，可以確保真的是你想要看的網頁。</p>
<p>作為網站的開發或者，使用 HTTPS 是最基本的了。以前有一段時間使多網站都同時提供 HTTP 跟 HTTPS 版本。主要可能是 HTTPS 會帶來 overhead，影響打開網站的反應速度。但是到了現在這一點點的差別已經可以完全無視了。把 HTTP 的訪問使用 301 Redirect 到 HTTPS，除了可以防止 HTTP 注入，瀏覽器會永久緩存 301 Redirect。瀏覽過你的網站的人，下次無論打開 HTTP 或 HTTPS 網站都會到 HTTPS 那裡。而 HTTPS 需要證書，所以也防止了 DNS 劫持，瀏覽器會彈出危險警告。</p>
<p>現在很多 HTTPS 用的 SSL 證書基本的才 US$10 一張，還有 <a href="https://letsencrypt.org" target="_blank" rel="noopener">Let’s Encrypt</a> 提供免費的證書，除了自甘墜落之外已經沒有不用的理由。雖然他們的免費證書只有 90 天，但是他們提供工具給你安全在服務器來自動化整個申請流程。當然肯定有人已經做好了 docker image，安裝了 docker 的同學可以一個命令生成證書，可以到<a href="https://github.com/pierreprinetti/certbot" target="_blank" rel="noopener">這裡</a>看看。還沒投身<a href="https://www.docker.com/" target="_blank" rel="noopener">Docker</a>的同學要快點上車了。</p>
</div><footer class="post__foot u-cf"><a href="/2018/04/07/page-hijacking/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2018-04-06T12:58:20.000Z" class="post__time">April 6, 2018</time><h1 class="post__title"><a href="/2018/04/06/encrypted-chat/">聊天加密</a></h1></header><div class="post__main echo"><p><img src="/images/encrypted-chat.jpg" alt=""></p>
<p>現在流行的聊天 app 基本都會使用 <strong>端到端加密</strong> (end-to-end encryption, E2EE)，使聊天更為安全。如 <a href="https://www.whatsapp.com/" target="_blank" rel="noopener">Whatsapp</a>, <a href="https://telegram.org/" target="_blank" rel="noopener">Telegram</a>, <a href="https://en.wikipedia.org/wiki/IMessage" target="_blank" rel="noopener">iMessage</a>。</p>
<p>由於聊天軟件都會有服務器，如果只是使用 HTTPS，訊息在服務端解密，所以控制到服務端的人，還是能看到你的聊天內容，所以只用 HTTPS 連線到服務器也未能滿足對聊天私密性的需求。</p>
<p>基本原理是 A 客戶端先把聊天內容加密發到服務器，服務器可能先保存或直接把加密過的內容發給 B 客戶端，然後 B 客戶端解密並顯示內容；由於服務端沒法解密，所以服務端保不保存聊天內容根本不用擔心。詳細原理可以看<a href="https://zh.wikipedia.org/wiki/端到端加密" target="_blank" rel="noopener">這裡</a>。</p>
</div><footer class="post__foot u-cf"><a href="/2018/04/06/encrypted-chat/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2018-04-05T12:58:20.000Z" class="post__time">April 5, 2018</time><h1 class="post__title"><a href="/2018/04/05/data-safety/">服務端安全</a></h1></header><div class="post__main echo"><p><img src="/images/sensor-tower-q2.jpg" alt="Image Credit: Sensor Tower"></p>
<h2 id="服務器數據安全"><a href="#服務器數據安全" class="headerlink" title="服務器數據安全"></a>服務器數據安全</h2><p>這裡要說的不是數據庫的問題，而是客戶端傳過來的數據。上面已經提到，客戶端的傳過來的數據要假設他可以被人任意修改，所以收到的每一個請求都必需檢查數據的真確性。這就是那麼多之前的 facebook 遊戲、手機遊戲、<a href="https://www.ea.com" target="_blank" rel="noopener">EA</a> 的遊戲被破解的原因，因為它們很多時候都不會對數據進行驗證。</p>
<p>你可能會懷疑這些大公司的軟件為什麼要這樣做，這是因為他們刻意如此。遊戲類的軟件，如果是在服務器計算，意思是服務器撿查每一個操作，例如每一幀畫面子彈的位置，就需要很多計算能力。除此之外還需要大量的網絡傳輸，網絡成本提高，而且客戶沒有良好網絡的時候，體驗會大打折扣，所以智能手機興起初期並沒有太多實時遊戲。所以他們的團隊因為用戶體驗、開發成本、營運成本而選擇了遊戲結果在客戶端計算的設計，客戶端發遊戲幣總額什麼的過來都存入數據庫，反正會破解遊戲的人基本上也不會付錢。</p>
<p>但是如果是用戶餘額、賬單總額這一類重要的數據就必需要驗證了。</p>
<p>順帶一提，<a href="http://supercell.com/en/games/clashofclans" target="_blank" rel="noopener">Clash of Clans</a> 的設計優美之處，以下是我對這個遊戲的觀察和猜測。這遊戲運作很 deterministic，每一局開始服務器會傳送敵陣的資料到客戶端，然後遊戲首先是在客戶端計算，最後把遊戲過程發送到服務端，所以遊戲中途就算手機斷線也不會有影響，只會在回合結束的時候可能會要等數據傳回服務器的情況。數據的內容不只是遊戲的結果，主要是每一個操作的時間，例如你選了哪一個兵種，點了哪一個位置。服務器收到後會重新計算一次，因為每一種兵都有一個 deterministic 的 AI，所以計算的時候同一個位置，同一個時間點，那一隻兵會做什麼都是相同的。當然這樣做還是不完美的，你可能可以在收到敵陣的數據之後，高速運算出最佳玩法，然後把最佳玩法返回給服務器(據觀察服務器有返回結果的時間限制)，但是為了玩個遊戲這樣做代價太大了。</p>
</div><footer class="post__foot u-cf"><a href="/2018/04/05/data-safety/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2018-04-04T16:00:00.000Z" class="post__time">April 5, 2018</time><h1 class="post__title"><a href="/2018/04/05/basic-security/">網絡安全誤會</a></h1></header><div class="post__main echo"><p><img src="/images/internet-security-1.jpg" alt=""></p>
<p>最近好像有遇到不少朋友誤會了一些所謂網絡安全的問題，所以想在這裡簡單地說一下。</p>
<h2 id="連線加密"><a href="#連線加密" class="headerlink" title="連線加密"></a>連線加密</h2><p>連線加密是用來防止連線過程中，數據被讀取、修改，主要是防止中間人。服務端把要發給客戶端數據的時候，先把數據加密再發出，到了客戶端的之後由客戶端解密再進行處理。有些人以為數據加密後，就只有客戶端軟件能解密，以為這就安全了。其實網絡軟件一個最基本原則，發出去東西，要假定客戶端收到一定能修改，客戶端發過來的東西也需要假定被修改過，一定要驗證。數據到了別人的電腦，你的軟件能解密，你用任何方法去防止別人拿出來也是徒勞的；在別人的電腦連 RAM 裡的數據都能讀取修改，就算你花盡心思，最後只不過是稍為讓別人多花了一點時間。<strong>重覆～ 除非客戶端不解密，否則加密只能防中間人。</strong></p>
<h3 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h3><p>既然連線加密只是為了防止中間人，不是為了防客戶端的話，那 HTTPS 就足夠了，而且基本上跟你開發的軟件方開，不會增加開發時間和繁雜程度。HTTPS 是一個最多人維護的標準，既然已經有人做好的東西，不要試圖去開發”自主開發”一套加密方法。只要你先假設發數據過來的可以是任何人、可以發任意的數據，而服務端有去譣證好是對的人、對的操作，那麼通信是用明文經 HTTPS 傳送也是安全的。<a href="https://robertheaton.com/2014/03/27/how-does-https-actually-work/" target="_blank" rel="noopener">自己去看原理</a>。</p>
<h4 id="其他可能要注意的地方"><a href="#其他可能要注意的地方" class="headerlink" title="其他可能要注意的地方"></a>其他可能要注意的地方</h4><ul>
<li>瀏覽器本身進行解密，所以一定能看到解密後的數據，所以要使用可靠的瀏覽器，如 <a href="https://www.google.com/chrome" target="_blank" rel="noopener">chrome</a>, <a href="https://firefox.com" target="_blank" rel="noopener">firefox</a>, <a href="https://www.apple.com/safari" target="_blank" rel="noopener">safari</a>。</li>
<li>由於 HTTPS 的安全在於對根證書的信任，所以不要胡亂在系統裡信任不明的證書，也不要使用可能或經常會信任不被廣泛信任的根證書的瀏覽器，例如中國出品的瀏覽器。</li>
<li>如果服務端或客戶端的機器中毒，還是會受中間人攻擊，HTTPS 安全只是在未解密的傳輸的時候。</li>
</ul>
</div><footer class="post__foot u-cf"><a href="/2018/04/05/basic-security/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2018 Joe Leung</div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><span title="Next" class="page-menu__link icon-arrow-right page-menu__link--disabled"></span></li></menu></footer></body></html>